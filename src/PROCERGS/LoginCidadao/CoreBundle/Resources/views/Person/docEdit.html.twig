{% extends "PROCERGSLoginCidadaoCoreBundle::base.loggedIn.html.twig" %} {% block content %}
<div id="profile-edit" class="content">

    <h1>{% trans %}Documents{% endtrans %}</h1>

    {% trans_default_domain 'FOSUserBundle' %}
    {{ form_start(form, {'action': path('lc_profile_doc_edit'), 'attr': {'role':'form' } }) }} {{ form_errors(form) }}

    <div class="form-content">
        <div class="row">
            <div class="col-md-7">
                <div class="form-group">
                    {{ form_label(form.cpf) }} 
                    {% if form.cpf.vars.value is not null %} 
                        {% if app.user.nfgAccessToken is null %} 
                            {{ form_widget(form.cpf, {'attr': {'class': 'form-control', 'maxlength' : '14'}}) }} 
                        {% else %} 
                            {{ form_widget(form.cpf, {'attr': {'type': 'hidden', 'style' : 'display: none;'}}) }}
                            <span> {{ form.cpf.vars.value|formatCpf }} </span> 
                        {% endif %}
                    {% endif %}
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                    <div class="input-error">{{ form_errors(form.cpf) }}</div>
                </div>
                <div class="form-group">
                    {{ form_label(form.voterRegistration) }} 
                    {% if app.user.nfgAccessToken is not null %} 
                        {% if form.voterRegistration.vars.value is null or form.voterRegistration.vars.value == '' %} 
                            {{ form_widget(form.voterRegistration, {'attr': {'class': 'form-control', 'maxlength' : '12'}}) }}
                            <div class="input-error">{{ form_errors(form.voterRegistration) }}</div>
                            <span class="extra">{% trans %}Don't know your Voter Registration number?{% endtrans %}<a target='blank' href="{{ tre_search_link }}">{{ 'Search it!' | trans }}</a></span> 
                            <span class="extra">{% trans %}Use your account on Nota Fiscal Gaúcha and validate your Voter Registration{% endtrans %}</span> 
                        {% else %} 
                            {% if app.user.nfgProfile.voterRegistrationSit is null or app.user.nfgProfile.voterRegistrationSit == 0 %} 
                                {{ form_widget(form.voterRegistration, {'attr': {'class': 'form-control', 'maxlength' : '12'}}) }}
                                <div class="input-error">{{ form_errors(form.voterRegistration) }}</div>
                                <span class="extra">{% trans %}Use your account on Nota Fiscal Gaúcha and authorize us to validate your Voter Registration{% endtrans %}</span> 
                            {% elseif app.user.nfgProfile.voterRegistrationSit == 1 %} 
                                {{ form_widget(form.voterRegistration, {'attr': {'type': 'hidden', 'style' : 'display: none;'}}) }}
                                <div class="input-error">{{ form_errors(form.voterRegistration) }}</div>
                                <span>{{ form.voterRegistration.vars.value }}</span> 
                            {% else %} 
                                {{ form_widget(form.voterRegistration, {'attr': {'class': 'form-control', 'maxlength' : '12'}}) }}
                                <div class="input-error">{{ form_errors(form.voterRegistration) }}</div>
                                <span class="extra">{% trans %}The Voter Registration used is not valid according to Nota Fiscal Gaúcha. Please type your Voter Registration correctly{% endtrans %}</span> 
                            {% endif %} 
                        {% endif %} 
                    {% else %} 
                        {{ form_widget(form.voterRegistration, {'attr': {'class': 'form-control', 'maxlength' : '12'}}) }}
                        <div class="input-error">{{ form_errors(form.voterRegistration) }}</div>
                        <span class="extra">{% trans %}Don't know your Voter Registration number?{% endtrans %} <a target='blank' href="{{ tre_search_link }}">{{ 'Search it!' | trans }}</a></span> 
                    {% endif %} 
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                </div>
                
            </div>
        </div>
    </div>
</div>
<div class="form-bar text-right">
    <input class="btn btn-success" type="submit" value="{{ 'profile.edit.submit'|trans }}" />
</div>
{{ form_end(form) }} {% endblock %} {% block javascripts %} {{ parent() }}
<script>
var profileDocEdit = {};
profileDocEdit.cpfId = '#{{ form.cpf.vars.id }}';
profileDocEdit.voterRegistrationId = '#{{ form.voterRegistration.vars.id }}';

var messages = {
    form: {
        voter_registration: {
            "invalid": "{{ 'form.voter_registration.invalid' | trans({}, "validators") }}"
        }
    }
};
$(function() {
	$(profileDocEdit.cpfId).mask('000.000.000-00');
	
	$(profileDocEdit.voterRegistrationId).mask('000000000000');
    $(profileDocEdit.voterRegistrationId).on('blur', function() {
	    if (!this.value.length) {
	        return;
	    }
	    this.value = zeroPadding(this.value, 12);
	    if (!checkVoterRegistration(this.value)) {
	        validator.check.error(this, messages.form.voter_registration.invalid);
	    }
    });
});
</script>
{% endblock %}
